<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vintage Closet</title>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2eT+p5l7Lp/P5x5X5g5t5w5t5w5t5w5w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Custom CSS for the carousel */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f4; /* stone-100 */
        }
        .carousel-item {
            position: absolute;
            inset: 0;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        .carousel-item.active {
            opacity: 1;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header Section -->
    <header class="bg-white sticky top-0 z-40 shadow-md p-4 flex justify-between items-center">
        <!-- Logo -->
        <h1 class="text-xl md:text-2xl font-bold text-stone-800 flex items-center">
            <button id="logo-button" class="flex items-center">
                <i class="fa-solid fa-shirt text-stone-600 mr-2 text-2xl"></i>
                Vintage Closet
            </button>
        </h1>
        <!-- Main Navigation -->
        <nav class="flex flex-grow justify-center space-x-6 text-stone-700">
            <button class="hover:text-stone-900 transition-colors" data-page="Men">Men</button>
            <button class="hover:text-stone-900 transition-colors" data-page="Women">Women</button>
            <button class="hover:text-stone-900 transition-colors" data-page="Kids">Kids</button>
        </nav>
        <!-- Icons and Buttons -->
        <div class="flex items-center space-x-2 md:space-x-4">
            <!-- Cart Button -->
            <button id="cart-button" class="flex items-center p-2 rounded-full text-stone-600 hover:text-stone-800 hover:bg-stone-200 transition-colors relative">
                <i class="fa-solid fa-cart-shopping text-xl"></i>
                <span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full opacity-0 transition-opacity">
                    0
                </span>
            </button>
            <!-- Login/Logout Button -->
            <button id="login-logout-button" class="flex items-center px-4 py-2 rounded-lg font-medium text-white bg-stone-800 hover:bg-stone-600 transition-all">
                <i class="fa-solid fa-user-circle mr-2"></i> Log In
            </button>
        </div>
    </header>
    
    <!-- Main Content Area -->
    <main class="flex-grow">
        <!-- Home Page -->
        <div id="home-page" class="p-4 md:p-8">
            <!-- Hero Banner Section -->
            <div class="mb-8 md:mb-12">
                <div class="relative w-full h-[400px] md:h-[600px] overflow-hidden rounded-xl shadow-lg">
                    <!-- Carousel Items -->
                    <div id="carousel-items">
                        <!-- Items will be dynamically populated by JS -->
                    </div>
                    <!-- Dot Indicators -->
                    <div id="carousel-dots" class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2 z-10">
                        <!-- Dots will be dynamically populated by JS -->
                    </div>
                </div>
            </div>
            <!-- Search Bar Section -->
            <div class="mb-6 md:mb-8 flex items-center bg-white rounded-lg shadow-lg p-2 max-w-md mx-auto">
                <i class="fa-solid fa-magnifying-glass text-stone-400 mr-2"></i>
                <input type="text" id="search-input" placeholder="Search for products..." class="w-full p-2 text-stone-700 bg-transparent focus:outline-none" />
            </div>
            <!-- Featured Products Section -->
            <div class="mt-8">
                <h2 class="text-2xl md:text-3xl font-bold mb-6 text-stone-800">Featured Products</h2>
                <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8">
                    <!-- Products will be dynamically populated here by JS -->
                </div>
                <div id="no-products-message" class="text-center text-stone-500 py-12 hidden">
                    <p class="text-xl">No products found.</p>
                </div>
            </div>
            <!-- Why Vintage Section -->
            <div class="mt-8 md:mt-12 bg-stone-200 rounded-xl p-6 md:p-8 shadow-inner">
                <h3 class="text-2xl md:text-3xl font-bold text-center mb-4 text-stone-800">Why Choose Vintage?</h3>
                <p class="text-center text-stone-600 max-w-3xl mx-auto text-sm md:text-base">
                    Vintage fashion is about more than just clothing; it's about sustainable style and a unique identity. By choosing vintage, you're not only getting a one-of-a-kind piece, but you're also contributing to a more circular and ethical fashion industry. Every item in our collection has been hand-selected for its quality, craftsmanship, and story.
                </p>
            </div>
        </div>

        <!-- Product Details Page (Hidden by default) -->
        <div id="product-details-page" class="p-4 md:p-8 hidden">
            <div class="max-w-4xl mx-auto bg-white p-6 md:p-8 rounded-xl shadow-lg">
                <button id="back-to-home" class="flex items-center text-stone-600 hover:text-stone-800 mb-6 transition-colors">
                    <i class="fa-solid fa-arrow-left mr-2"></i> Back to Products
                </button>
                <div id="product-details-container" class="flex flex-col md:flex-row gap-6 md:gap-8">
                    <!-- Product details will be dynamically populated by JS -->
                </div>
            </div>
        </div>
        
        <!-- Cart Page (Hidden by default) -->
        <div id="cart-page" class="p-4 md:p-8 hidden min-h-[calc(100vh-64px-160px)]">
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg max-w-3xl mx-auto">
                <h2 class="text-2xl md:text-3xl font-bold mb-6 text-stone-800">Your Cart</h2>
                <div id="cart-items-list" class="divide-y divide-stone-200 mb-6">
                    <!-- Cart items will be dynamically populated here -->
                </div>
                <div id="cart-summary" class="border-t border-stone-200 pt-6 mt-6 flex justify-between items-center hidden">
                    <span class="text-xl font-bold text-stone-800">Total: <span id="cart-total-price"></span></span>
                    <button id="checkout-button" class="px-4 py-2 rounded-lg font-medium text-white bg-stone-800 hover:bg-stone-600 transition-all">
                        Place Order</button>
                </div>
                <p id="empty-cart-message" class="text-stone-500">Your cart is empty. Start shopping!</p>
            </div>
        </div>
        
        <!-- Login Page (Hidden by default) -->
        <div id="login-page" class="flex items-center justify-center p-8 hidden min-h-[calc(100vh-64px-160px)]">
            <div class="bg-white p-8 rounded-xl shadow-lg max-w-md w-full">
                <h2 class="text-2xl font-bold text-center mb-6 text-stone-800">Login</h2>
                <form id="login-form">
                    <div class="mb-4">
                        <label class="block text-stone-700 mb-2" for="username">Username</label>
                        <input type="text" id="username" class="w-full px-4 py-2 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-stone-500" />
                    </div>
                    <div class="mb-6">
                        <label class="block text-stone-700 mb-2" for="password">Password</label>
                        <input type="password" id="password" class="w-full px-4 py-2 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-stone-500" />
                    </div>
                    <button type="submit" class="w-full px-4 py-2 rounded-lg font-medium text-white bg-stone-800 hover:bg-stone-600 transition-all">
                        Log In
                    </button>
                </form>
            </div>
        </div>

        <!-- Category Pages (Hidden by default) -->
        <div id="category-page" class="p-4 md:p-8 hidden min-h-[calc(100vh-64px-160px)]">
            <div class="flex justify-between items-center mb-6">
                <h2 id="category-page-title" class="text-2xl md:text-3xl font-bold text-stone-800"></h2>
                <div class="flex items-center space-x-2">
                    <label for="sort" class="text-stone-600 font-medium text-sm">Sort By:</label>
                    <select id="sort-select" class="p-2 border border-stone-300 rounded-lg text-stone-700 focus:outline-none focus:ring-2 focus:ring-stone-500 text-sm">
                        <option value="default">Default</option>
                        <option value="price-low-high">Price: Low to High</option>
                        <option value="price-high-low">Price: High to Low</option>
                        <option value="name-a-z">Name: A-Z</option>
                    </select>
                </div>
            </div>
            <div id="category-product-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8">
                <!-- Category products will be dynamically populated here -->
            </div>
            <p id="no-category-products-message" class="text-stone-500 hidden">No products found in this category.</p>
        </div>

    </main>

    <!-- Footer Section -->
    <footer class="bg-stone-900 text-white p-6 md:p-8 mt-auto">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center text-center md:text-left">
            <div class="mb-4 md:mb-0">
                <h3 class="text-2xl font-bold mb-2">Vintage Closet</h3>
                <p class="text-stone-400 text-sm">&copy; <span id="current-year"></span> All Rights Reserved.</p>
            </div>
            <div class="flex flex-col md:flex-row items-center md:space-x-8 space-y-2 md:space-y-0 text-sm">
                <a href="#" class="text-stone-300 hover:text-white transition-colors">About Us</a>
                <a href="#" class="text-stone-300 hover:text-white transition-colors">Contact</a>
                <a href="#" class="text-stone-300 hover:text-white transition-colors">Privacy Policy</a>
                <a href="#" class="text-stone-300 hover:text-white transition-colors">Terms of Service</a>
            </div>
        </div>
    </footer>

    <!-- Reusable Modal (Hidden by default) -->
    <div id="modal-container" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 hidden">
        <div class="bg-white p-6 rounded-xl shadow-lg w-full max-w-sm">
            <div class="flex justify-between items-center mb-4">
                <h2 id="modal-title" class="text-xl font-semibold text-stone-800"></h2>
                <button id="modal-close-button" class="text-stone-500 hover:text-stone-800">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>
            <p id="modal-message" class="text-stone-700"></p>
            <div class="mt-6 text-right">
                <button id="modal-ok-button" class="px-4 py-2 rounded-lg font-medium text-white bg-stone-800 hover:bg-stone-600 transition-all">Close</button>
            </div>
        </div>
    </div>
    
    <script>
        // --- DATA ---
        const products = [
          {
            id: 1,
            name: 'Classic Trench Coat',
            price: 125.00,
            imageUrl: 'https://placehold.co/400x600/b8a782/333333?text=Trench+Coat',
            colors: ['Stone', 'Charcoal'],
            sizes: ['S', 'M', 'L', 'XL'],
            description: 'A timeless piece for any season. Made from a durable, water-resistant material. It features classic details like a double-breasted front and belted waist, making it a stylish and practical choice for any wardrobe.',
            category: 'Men'
          },
          {
            id: 2,
            name: 'Vintage Denim Jacket',
            price: 85.00,
            imageUrl: 'https://placehold.co/400x600/8d856d/FFFFFF?text=Denim+Jacket',
            colors: ['Washed Blue', 'Dark Indigo'],
            sizes: ['XS', 'S', 'M', 'L'],
            description: 'Authentic 90s style, perfectly worn-in feel. Our vintage denim jacket is a casual wardrobe staple. It features a relaxed fit and button-up front, perfect for layering over a dress or t-shirt.',
            category: 'Women'
          },
          {
            id: 3,
            name: 'Floral A-line Dress',
            price: 60.00,
            imageUrl: 'https://placehold.co/400x600/d4bba9/663300?text=Floral+Dress',
            colors: ['Crimson Red', 'Mustard Yellow'],
            sizes: ['S', 'M', 'L'],
            description: 'Lightweight and airy, perfect for a sunny day. This A-line dress features a delicate floral pattern and a flattering silhouette. It\'s ideal for a picnic or a garden party.',
            category: 'Women'
          },
          {
            id: 4,
            name: 'Woolen Scarf',
            price: 35.00,
            imageUrl: 'https://placehold.co/400x600/a58d83/FFFFFF?text=Wool+Scarf',
            colors: ['Burnt Orange', 'Forest Green'],
            sizes: ['One Size'],
            description: 'Soft, warm, and stylish. A winter essential. Made from a high-quality wool blend, this scarf provides warmth and comfort without sacrificing style. A perfect accessory for any cold-weather outfit.',
            category: 'Kids'
          },
          {
            id: 5,
            name: 'Corduroy Trousers',
            price: 75.00,
            imageUrl: 'https://placehold.co/400x600/967d6c/FFFFFF?text=Trousers',
            colors: ['Chocolate Brown', 'Olive Green'],
            sizes: ['30', '32', '34', '36'],
            description: 'Comfortable and durable, with a classic corduroy texture. These trousers offer a relaxed fit and a timeless look. They are perfect for casual outings or a comfortable day at home.',
            category: 'Men'
          },
          {
            id: 6,
            name: 'Leather Boots',
            price: 150.00,
            imageUrl: 'https://placehold.co/400x600/69594e/FFFFFF?text=Leather+Boots',
            colors: ['Black', 'Brown'],
            sizes: ['7', '8', '9', '10', '11'],
            description: 'Handcrafted leather boots for a rugged, timeless look. These durable boots are built for comfort and style. They feature a non-slip sole and a cushioned insole for all-day wear.',
            category: 'Men'
          },
        ];

        // Get a few unique products for the carousel
        const carouselProducts = [products[0], products[2], products[4]];

        // --- STATE MANAGEMENT (GLOBAL VARIABLES) ---
        let currentPage = 'home';
        let isLoggedIn = false;
        let cartItems = [];
        let selectedProduct = null;

        // --- DOM ELEMENT REFERENCES ---
        const pageElements = {
            home: document.getElementById('home-page'),
            productDetails: document.getElementById('product-details-page'),
            cart: document.getElementById('cart-page'),
            login: document.getElementById('login-page'),
            category: document.getElementById('category-page')
        };
        const productGrid = document.getElementById('product-grid');
        const noProductsMessage = document.getElementById('no-products-message');
        const productDetailsContainer = document.getElementById('product-details-container');
        const cartItemsList = document.getElementById('cart-items-list');
        const cartSummary = document.getElementById('cart-summary');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const cartCount = document.getElementById('cart-count');
        const cartTotalPrice = document.getElementById('cart-total-price');
        const loginLogoutButton = document.getElementById('login-logout-button');
        const loginForm = document.getElementById('login-form');
        const modalContainer = document.getElementById('modal-container');
        const sortSelect = document.getElementById('sort-select');
        const categoryPageTitle = document.getElementById('category-page-title');
        const categoryProductGrid = document.getElementById('category-product-grid');
        const noCategoryProductsMessage = document.getElementById('no-category-products-message');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');

        // --- HELPER FUNCTIONS ---
        /** Displays a modal message. */
        function showModal(title, message, success) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalTitle.classList.toggle('text-green-600', success);
            modalTitle.classList.toggle('text-red-600', !success);
            modalContainer.classList.remove('hidden');
        }
        
        // --- RENDER FUNCTIONS ---
        /** Renders the carousel with products and starts the autoplay. */
        function renderCarousel() {
            const carouselItemsContainer = document.getElementById('carousel-items');
            const carouselDotsContainer = document.getElementById('carousel-dots');
            carouselItemsContainer.innerHTML = '';
            carouselDotsContainer.innerHTML = '';

            carouselProducts.forEach((product, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = `carousel-item ${index === 0 ? 'active' : ''}`;
                itemDiv.innerHTML = `
                    <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-full object-cover" />
                    <div class="absolute inset-0 bg-black bg-opacity-40 flex flex-col items-center justify-center text-white text-center p-4">
                        <h2 class="text-4xl sm:text-5xl md:text-6xl font-bold mb-4 drop-shadow-lg">${product.name}</h2>
                        <p class="text-lg sm:text-xl md:text-2xl mb-8 max-w-2xl drop-shadow-md">
                            $${product.price.toFixed(2)} - ${product.description.substring(0, 50)}...
                        </p>
                        <button class="px-8 py-3 rounded-lg font-medium text-white bg-stone-800 hover:bg-stone-600 transition-all text-lg" data-product-id="${product.id}">
                            View Details
                        </button>
                    </div>
                `;
                carouselItemsContainer.appendChild(itemDiv);

                const dotDiv = document.createElement('div');
                dotDiv.className = `w-3 h-3 rounded-full transition-colors ${index === 0 ? 'bg-white' : 'bg-white bg-opacity-50'}`;
                carouselDotsContainer.appendChild(dotDiv);
            });

            let currentImageIndex = 0;
            const items = carouselItemsContainer.querySelectorAll('.carousel-item');
            const dots = carouselDotsContainer.querySelectorAll('div');

            setInterval(() => {
                items[currentImageIndex].classList.remove('active');
                dots[currentImageIndex].classList.remove('bg-white');
                dots[currentImageIndex].classList.add('bg-opacity-50');

                currentImageIndex = (currentImageIndex + 1) % carouselProducts.length;

                items[currentImageIndex].classList.add('active');
                dots[currentImageIndex].classList.add('bg-white');
                dots[currentImageIndex].classList.remove('bg-opacity-50');
            }, 5000); // 5 second interval
        }

        /** Renders the product cards. */
        function renderProductCards(filteredProducts, container) {
            container.innerHTML = ''; // Clear previous content
            const noMessageElement = container === productGrid ? noProductsMessage : noCategoryProductsMessage;
            if (filteredProducts.length === 0) {
                noMessageElement.classList.remove('hidden');
            } else {
                noMessageElement.classList.add('hidden');
                filteredProducts.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'bg-white p-4 rounded-xl shadow-lg flex flex-col items-center text-center cursor-pointer hover:shadow-xl transition-shadow duration-300';
                    productCard.setAttribute('data-product-id', product.id);
                    productCard.innerHTML = `
                        <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-auto rounded-xl mb-4 object-cover" />
                        <h3 class="text-xl font-semibold mb-1 text-stone-800">${product.name}</h3>
                        <p class="text-stone-600 mb-2">$${product.price.toFixed(2)}</p>
                        <p class="text-sm text-stone-500 mb-4 h-12 overflow-hidden">${product.description}</p>
                    `;
                    container.appendChild(productCard);
                });
            }
        }

        /** Renders the product details page. */
        function renderProductDetails(product) {
            if (!product) return;

            productDetailsContainer.innerHTML = ''; // Clear previous details
            
            productDetailsContainer.innerHTML = `
                <div class="flex-1">
                    <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-auto rounded-xl shadow-md" />
                </div>
                <div class="flex-1">
                    <h2 class="text-2xl md:text-3xl font-bold mb-2 text-stone-800">${product.name}</h2>
                    <p class="text-xl md:text-2xl text-stone-600 mb-4">$${product.price.toFixed(2)}</p>
                    <p class="text-stone-700 mb-6 text-sm md:text-base">${product.description}</p>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-stone-700 mb-1">Color</label>
                        <select id="color-select" class="w-full px-3 py-2 border border-stone-300 rounded-lg text-stone-700 focus:outline-none focus:ring-2 focus:ring-stone-500">
                            <option value="" disabled selected>Select a color</option>
                            ${product.colors.map(color => `<option value="${color}">${color}</option>`).join('')}
                        </select>
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-stone-700 mb-1">Size</label>
                        <select id="size-select" class="w-full px-3 py-2 border border-stone-300 rounded-lg text-stone-700 focus:outline-none focus:ring-2 focus:ring-stone-500">
                            <option value="" disabled selected>Select a size</option>
                            ${product.sizes.map(size => `<option value="${size}">${size}</option>`).join('')}
                        </select>
                    </div>
                    <button id="add-to-cart-button" class="w-full px-4 py-2 rounded-lg font-medium text-white bg-stone-800 hover:bg-stone-600 transition-all">
                        Add to Cart
                    </button>
                </div>
            `;
            
            const moreOptionsDiv = document.createElement('div');
            moreOptionsDiv.className = 'mt-8 md:mt-12 w-full';
            const moreProducts = products.filter(p => p.id !== product.id);
            if (moreProducts.length > 0) {
                moreOptionsDiv.innerHTML = `
                    <h3 class="text-xl md:text-2xl font-bold mb-6 text-stone-800">More Options</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 md:gap-6">
                        ${moreProducts.map(p => `
                            <div class="bg-stone-50 p-4 rounded-xl shadow-sm text-center">
                                <img src="${p.imageUrl}" alt="${p.name}" class="w-full h-40 object-cover rounded-lg mb-2" />
                                <h4 class="text-base md:text-lg font-semibold text-stone-800">${p.name}</h4>
                                <p class="text-sm md:text-base text-stone-600">$${p.price.toFixed(2)}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
                productDetailsContainer.parentNode.appendChild(moreOptionsDiv);
            }
        }

        /** Renders the cart page content. */
        function renderCart() {
            cartItemsList.innerHTML = '';
            if (cartItems.length === 0) {
                emptyCartMessage.classList.remove('hidden');
                cartSummary.classList.add('hidden');
            } else {
                emptyCartMessage.classList.add('hidden');
                cartSummary.classList.remove('hidden');
                cartItems.forEach(item => {
                    const listItem = document.createElement('li');
                    listItem.className = 'py-4 flex items-center justify-between';
                    listItem.innerHTML = `
                        <div class="flex items-center">
                            <img src="${item.imageUrl}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg mr-4" />
                            <div>
                                <h3 class="text-lg font-medium text-stone-800">${item.name}</h3>
                                <p class="text-sm text-stone-600">
                                    Color: ${item.selectedColor} / Size: ${item.selectedSize}
                                </p>
                                <p class="text-stone-500 mt-1">$${item.price.toFixed(2)}</p>
                            </div>
                        </div>
                        <button class="remove-from-cart text-red-500 hover:text-red-700 transition-colors" data-unique-id="${item.uniqueId}">
                            <i class="fa-solid fa-xmark text-xl"></i>
                        </button>
                    `;
                    cartItemsList.appendChild(listItem);
                });
                const total = cartItems.reduce((acc, item) => acc + item.price, 0);
                cartTotalPrice.textContent = total.toFixed(2);
            }
            updateCartCount();
        }

        /** Updates the cart count icon. */
        function updateCartCount() {
            cartCount.textContent = cartItems.length;
            if (cartItems.length > 0) {
                cartCount.classList.remove('opacity-0');
            } else {
                cartCount.classList.add('opacity-0');
            }
        }

        /** Renders the category page with filtered and sorted products. */
        function renderCategoryPage(categoryName) {
            categoryPageTitle.textContent = categoryName;
            
            const sortAndRender = () => {
                const sortOption = sortSelect.value;
                const categoryProducts = products.filter(p => p.category === categoryName);
                const sortedProducts = [...categoryProducts].sort((a, b) => {
                    switch (sortOption) {
                        case 'price-low-high': return a.price - b.price;
                        case 'price-high-low': return b.price - a.price;
                        case 'name-a-z': return a.name.localeCompare(b.name);
                        default: return 0;
                    }
                });
                renderProductCards(sortedProducts, categoryProductGrid);
            };

            sortAndRender(); // Initial render
            sortSelect.onchange = sortAndRender; // Re-render on sort change
        }

        /** Main function to switch pages and update UI. */
        function renderPage(pageName, productId = null) {
            Object.values(pageElements).forEach(el => el.classList.add('hidden'));

            switch (pageName) {
                case 'home':
                    pageElements.home.classList.remove('hidden');
                    renderProductCards(products, productGrid);
                    break;
                case 'product-details':
                    pageElements.productDetails.classList.remove('hidden');
                    selectedProduct = products.find(p => p.id === productId);
                    renderProductDetails(selectedProduct);
                    break;
                case 'cart':
                    pageElements.cart.classList.remove('hidden');
                    renderCart();
                    break;
                case 'login':
                    pageElements.login.classList.remove('hidden');
                    break;
                case 'Men':
                case 'Women':
                case 'Kids':
                    pageElements.category.classList.remove('hidden');
                    renderCategoryPage(pageName);
                    break;
                default:
                    pageElements.home.classList.remove('hidden');
                    renderProductCards(products, productGrid);
            }
            currentPage = pageName;
        }

        // --- EVENT LISTENERS ---
        // Global listener for navigation buttons
        document.addEventListener('click', (e) => {
            const pageButton = e.target.closest('[data-page]');
            if (pageButton) {
                renderPage(pageButton.dataset.page);
            }
        });

        // Specific button clicks
        document.getElementById('logo-button').addEventListener('click', () => renderPage('home'));
        document.getElementById('cart-button').addEventListener('click', () => renderPage('cart'));

        // Handle login/logout for the desktop button
        document.getElementById('login-logout-button').addEventListener('click', () => {
            if (isLoggedIn) {
                isLoggedIn = false;
                document.getElementById('login-logout-button').innerHTML = '<i class="fa-solid fa-user-circle mr-2"></i> Log In';
            } else {
                renderPage('login');
            }
        });
        
        // Event delegation for product card clicks (for all product grids)
        document.addEventListener('click', (e) => {
            const productCard = e.target.closest('[data-product-id]');
            if (productCard) {
                const productId = parseInt(productCard.dataset.productId);
                renderPage('product-details', productId);
            }
        });
        
        // Cart and checkout buttons
        document.getElementById('cart-page').addEventListener('click', (e) => {
            const removeButton = e.target.closest('.remove-from-cart');
            if (removeButton) {
                const uniqueId = removeButton.dataset.uniqueId;
                cartItems = cartItems.filter(item => item.uniqueId !== uniqueId);
                renderCart();
            }
        });
        document.getElementById('checkout-button').addEventListener('click', () => {
            showModal('Order Placed!', 'Your order has been successfully placed. Thank you for shopping with us!', true);
            cartItems = [];
            renderCart();
        });

        // Login form submission
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if (document.getElementById('username').value && document.getElementById('password').value) {
                isLoggedIn = true;
                document.getElementById('login-logout-button').innerHTML = '<i class="fa-solid fa-right-from-bracket mr-2"></i> Log Out';
                renderPage('home');
            } else {
                showModal('Login Failed', 'Please enter a username and password.', false);
            }
        });

        // Add to Cart button on product details page
        document.getElementById('product-details-page').addEventListener('click', (e) => {
            if (e.target.id === 'add-to-cart-button') {
                const colorSelect = document.getElementById('color-select');
                const sizeSelect = document.getElementById('size-select');
                const selectedColor = colorSelect.value;
                const selectedSize = sizeSelect.value;
                
                if (selectedColor && selectedSize) {
                    const itemToAdd = {
                        ...selectedProduct,
                        selectedColor,
                        selectedSize,
                        uniqueId: `${selectedProduct.id}-${selectedColor}-${selectedSize}-${Date.now()}`
                    };
                    cartItems.push(itemToAdd);
                    showModal('Item Added!', `${itemToAdd.name} has been added to your cart.`, true);
                    updateCartCount();
                } else {
                    showModal('Error', 'Please select a color and size.', false);
                }
            }
        });

        // Back button on product details page
        document.getElementById('back-to-home').addEventListener('click', () => {
            renderPage('home');
        });

        // Close modal button
        document.getElementById('modal-ok-button').addEventListener('click', () => modalContainer.classList.add('hidden'));
        document.getElementById('modal-close-button').addEventListener('click', () => modalContainer.classList.add('hidden'));

        // Search functionality
        document.getElementById('search-input').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredProducts = products.filter(p =>
                p.name.toLowerCase().includes(searchTerm) ||
                p.description.toLowerCase().includes(searchTerm)
            );
            renderProductCards(filteredProducts, productGrid);
        });

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('current-year').textContent = new Date().getFullYear();
            renderCarousel();
            renderPage('home');
            updateCartCount();
        });
    </script>
</body>
</html>
